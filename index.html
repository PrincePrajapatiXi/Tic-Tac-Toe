<!-- Pro Tic-Tac-Toe — Single Player vs AI (Easy / Medium / Pro)
     Features:
     - Single-player only (you vs AI)
     - Three difficulty modes: Easy (random), Medium (heuristic + occasional mistake), Pro (unbeatable Minimax)
     - Move sounds, victory fanfare, draw sound
     - Background music: calm and intense with auto-switch + manual toggle
     - Undo, New Round, Restart, move history, score tracking
     - Keyboard support and accessibility

Save this file as `pro-tictactoe-ai.html` and open in a modern browser.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pro Tic-Tac-Toe — vs AI</title>
  <style>
    :root{
      --bg:#081226; --card:#07182a; --muted:#9fb0c8; --accent:#06b6d4; --accent2:#f97316; --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;display:flex;align-items:center;justify-content:center;padding:22px;background:radial-gradient(800px 400px at 10% 10%, rgba(6,182,212,0.04), transparent), var(--bg);color:#e6eef8}
    .wrap{width:100%;max-width:980px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;display:grid;grid-template-columns:1fr 340px;gap:16px;box-shadow:0 10px 40px rgba(2,6,23,0.7)}
    header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center}
    h1{font-size:20px;margin:0}
    .subtitle{color:var(--muted);font-size:13px}

    .board-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
    .board{width:min(480px,78vw);height:min(480px,78vw);display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
    .cell{background:var(--glass);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:clamp(28px,7vw,84px);font-weight:800;cursor:pointer;user-select:none;transition:transform .12s ease, box-shadow .12s}
    .cell:hover{transform:translateY(-4px);box-shadow:0 14px 34px rgba(2,6,23,0.6)}
    .cell.disabled{cursor:not-allowed;opacity:.92}
    .cell.x{color:var(--accent2)}
    .cell.o{color:var(--accent)}
    .highlight{background:rgba(16,185,129,0.12);box-shadow:inset 0 -8px 22px rgba(2,6,23,0.5);border-radius:10px}

    .sidebar{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px}
    .controls{display:flex;flex-direction:column;gap:10px}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#071026;border:none}
    .row{display:flex;gap:8px;align-items:center}
    .status{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:700;text-align:center}
    .score{display:flex;gap:8px;justify-content:space-between;padding:6px 0}
    .score .item{flex:1;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);text-align:center}
    .history{max-height:210px;overflow:auto;margin-top:8px;padding:8px;background:rgba(255,255,255,0.01);border-radius:8px}
    .history ol{margin:0;padding-left:18px;color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}
    footer{grid-column:1/-1;text-align:center;padding-top:6px;color:var(--muted);font-size:13px}

    @media (max-width:920px){.wrap{grid-template-columns:1fr;}.sidebar{order:2}}
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Pro Tic Tac Toe vs AI">
    <header>
      <div>
        <h1>Pro Tic-Tac-Toe — You vs AI</h1>
        <div class="subtitle">Difficulty: Easy • Medium • Pro (Unbeatable). Keyboard: 1–9 or arrows + Enter.</div>
      </div>
      <div class="row">
        <button id="undoBtn" class="btn">Undo</button>
        <button id="restartBtn" class="btn">Restart</button>
      </div>
    </header>

    <main class="board-wrap">
      <div id="board" class="board" role="grid" aria-label="tic tac toe board">
        <!-- cells generated by JS -->
      </div>
      <div id="status" class="status" aria-live="polite">Loading…</div>
    </main>

    <aside class="sidebar">
      <div class="controls">
        <label class="muted">AI Difficulty</label>
        <select id="difficulty" class="btn" aria-label="Select AI difficulty">
          <option value="easy">Easy</option>
          <option value="medium" selected>Medium</option>
          <option value="pro">Pro (Unbeatable)</option>
        </select>

        <div class="row">
          <button id="newRoundBtn" class="btn primary">New Round</button>
        </div>

        <div class="score" aria-hidden="false">
          <div class="item"><div style="font-size:12px;color:var(--muted)">You (X)</div><div id="scoreYou" style="font-size:18px">0</div></div>
          <div class="item"><div style="font-size:12px;color:var(--muted)">Ties</div><div id="scoreT" style="font-size:18px">0</div></div>
          <div class="item"><div style="font-size:12px;color:var(--muted)">AI (O)</div><div id="scoreAI" style="font-size:18px">0</div></div>
        </div>

        <div class="history">
          <strong style="display:block;margin-bottom:6px">Move History</strong>
          <ol id="historyList"></ol>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <button id="muteBtn" class="btn">Mute</button>
          <button id="switchMusicBtn" class="btn">Switch Track</button>
        </div>

        <div class="muted" style="margin-top:8px">Auto-intensify music when the board is nearly full. Press R to restart, U to undo.</div>
      </div>
    </aside>

    <footer>Created for pro practice — unbeatable AI included.</footer>
  </div>

  <script>
  // ===== Assets (external royalty-free audio links) =====
  // You can replace these URLs with local base64 data URIs if you want a single-file offline version.
  const ASSETS = {
    sounds: {
      click: 'https://cdn.pixabay.com/download/audio/2022/08/15/audio_90cc1a4c4f.mp3?filename=button-click-110026.mp3',
      win: 'https://cdn.pixabay.com/download/audio/2021/08/04/audio_0a6c6b8c10.mp3?filename=triumph-6946.mp3',
      draw: 'https://cdn.pixabay.com/download/audio/2021/08/04/audio_5b15b2df1b.mp3?filename=short-bell-7124.mp3',
      fanfare: 'https://cdn.pixabay.com/download/audio/2021/12/15/audio_3b8f8c8d41.mp3?filename=fanfare-6943.mp3'
    },
    music: {
      calm: 'https://cdn.pixabay.com/download/audio/2024/02/07/audio_2b7b3f6fa1.mp3?filename=calm-ambient-16627.mp3',
      intense: 'https://cdn.pixabay.com/download/audio/2023/11/06/audio_9d6d7b0f64.mp3?filename=intense-loop-13012.mp3'
    }
  };

  // ===== DOM =====
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const historyList = document.getElementById('historyList');
  const scoreYouEl = document.getElementById('scoreYou');
  const scoreAIEl = document.getElementById('scoreAI');
  const scoreTEl = document.getElementById('scoreT');
  const undoBtn = document.getElementById('undoBtn');
  const restartBtn = document.getElementById('restartBtn');
  const newRoundBtn = document.getElementById('newRoundBtn');
  const difficultySelect = document.getElementById('difficulty');
  const muteBtn = document.getElementById('muteBtn');
  const switchMusicBtn = document.getElementById('switchMusicBtn');

  // ===== Game State =====
  let board = Array(9).fill(null); // indices 0..8
  let history = []; // {player, idx}
  let currentPlayer = 'X'; // you are X, AI is O
  let startingPlayer = 'X';
  let scores = {You:0, AI:0, T:0};
  let gameOver = false;
  let musicMuted = false;
  let currentMusic = null;
  let calmTrack = new Audio(ASSETS.music.calm);
  let intenseTrack = new Audio(ASSETS.music.intense);
  calmTrack.loop = true; intenseTrack.loop = true;
  currentMusic = calmTrack;

  // sound effects
  const clickS = new Audio(ASSETS.sounds.click);
  const winS = new Audio(ASSETS.sounds.win);
  const drawS = new Audio(ASSETS.sounds.draw);
  const fanfare = new Audio(ASSETS.sounds.fanfare);

  function playSound(a){ try{ a.currentTime = 0; a.play(); } catch(e){} }

  // ===== Board UI =====
  function createBoard(){
    boardEl.innerHTML = '';
    for(let i=0;i<9;i++){
      const d = document.createElement('div');
      d.className = 'cell';
      d.tabIndex = 0;
      d.setAttribute('data-index', i);
      d.setAttribute('role','button');
      d.setAttribute('aria-label', `Cell ${i+1}`);
      d.addEventListener('click', onCellClick);
      d.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); onCellClick({currentTarget:d}); } });
      boardEl.appendChild(d);
    }
  }

  function render(){
    const cells = boardEl.querySelectorAll('.cell');
    cells.forEach((cell,i)=>{
      cell.classList.remove('x','o','disabled','highlight');
      const v = board[i];
      cell.textContent = v ? v : '';
      if(v) cell.classList.add(v.toLowerCase());
      if(gameOver || v) cell.classList.add('disabled');
    });

    // status
    if(gameOver){
      const win = checkWinner(board);
      if(win && win.winner){
        statusEl.textContent = `Winner: ${win.winner === 'X' ? 'You (X)' : 'AI (O)'}`;
        win.line.forEach(i=> boardEl.querySelector(`.cell[data-index='${i}']`).classList.add('highlight'));
      } else {
        statusEl.textContent = 'Draw';
      }
    } else {
      statusEl.textContent = `Turn: ${currentPlayer === 'X' ? 'You (X)' : 'AI (O)'}`;
    }

    // history
    historyList.innerHTML = '';
    history.forEach((m,idx)=>{ const li=document.createElement('li'); li.textContent = `${idx+1}. ${m.player} → ${m.idx+1}`; historyList.appendChild(li); });

    scoreYouEl.textContent = scores.You; scoreAIEl.textContent = scores.AI; scoreTEl.textContent = scores.T;
  }

  // ===== Game Logic =====
  const winningLines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  function checkWinner(b){
    for(const line of winningLines){ const [a,b1,c]=line; if(b[a] && b[a]===b[b1] && b[a]===b[c]) return {winner:b[a], line}; }
    if(b.every(Boolean)) return {winner:null};
    return null;
  }

  function onCellClick(e){ const idx = Number(e.currentTarget.getAttribute('data-index')); playerMove(idx); }

  function playerMove(idx){ if(gameOver || board[idx]) return; makeMove(idx,'X'); }

  function makeMove(idx, player){
    if(board[idx] || gameOver) return false;
    board[idx]=player; history.push({player, idx}); playSound(clickS);

    const win = checkWinner(board);
    if(win){
      gameOver=true;
      if(win.winner){ if(win.winner==='X') scores.You++; else scores.AI++; playSound(winS); setTimeout(()=>playSound(fanfare),200); }
      else { scores.T++; playSound(drawS); }
      render(); return true;
    }

    // switch
    currentPlayer = player==='X' ? 'O' : 'X';
    render();

    // AI move if it's AI's turn
    if(!gameOver && currentPlayer==='O'){
      setTimeout(()=> aiMove(), 280);
    }
    return true;
  }

  // ===== AI =====
  function aiMove(){
    const difficulty = difficultySelect.value; // easy, medium, pro
    let move;
    if(difficulty==='easy'){
      // random available
      const avail = board.map((v,i)=> v?null:i).filter(v=>v!==null);
      move = avail[Math.floor(Math.random()*avail.length)];
    } else if(difficulty==='medium'){
      // sometimes make best move, sometimes a near-best (introduce mistake chance)
      if(Math.random() < 0.6){ move = minimaxDecision(board,'O').move; }
      else { const avail = board.map((v,i)=> v?null:i).filter(v=>v!==null); move = avail[Math.floor(Math.random()*avail.length)]; }
    } else {
      // pro: unbeatable
      move = minimaxDecision(board,'O').move;
    }
    // fallback
    if(move===undefined) { const avail = board.map((v,i)=> v?null:i).filter(v=>v!==null); move = avail[0]; }
    makeMove(move,'O');
  }

  // Minimax with simple pruning
  function minimaxDecision(bd, player){
    // returns {move, score}
    const opponent = player==='X' ? 'O' : 'X';

    function scoresForWinner(winner, depth){ if(winner===player) return 10 - depth; if(winner===opponent) return depth - 10; return 0; }

    function minimax(state, depth, isMaximizing){
      const res = checkWinner(state);
      if(res){ return {score: scoresForWinner(res.winner, depth)}; }

      if(isMaximizing){
        let best = {score:-Infinity};
        for(let i=0;i<9;i++){ if(!state[i]){
          state[i]=player; const r = minimax(state, depth+1, false); state[i]=null; if(r.score>best.score){ best={score:r.score, move:i}; }
        }}
        return best;
      } else {
        let best = {score:Infinity};
        for(let i=0;i<9;i++){ if(!state[i]){
          state[i]=opponent; const r = minimax(state, depth+1, true); state[i]=null; if(r.score<best.score){ best={score:r.score, move:i}; }
        }}
        return best;
      }
    }

    return minimax(bd.slice(), 0, true);
  }

  // ===== Undo / Reset / Round =====
  function undo(){ if(history.length===0 || gameOver) return; const last = history.pop(); board[last.idx]=null; // if last was AI, also pop human move
    if(history.length && history[history.length-1].player==='X' && last.player==='O'){ const prev = history.pop(); board[prev.idx]=null; currentPlayer='X'; } else { currentPlayer = last.player; }
    gameOver=false; render(); }

  function resetBoard(newRound=false){ board = Array(9).fill(null); history = []; gameOver=false; if(newRound){ startingPlayer = startingPlayer==='X' ? 'O' : 'X'; }
    currentPlayer = startingPlayer; render(); // if AI should start
    if(currentPlayer==='O'){ setTimeout(()=> aiMove(), 300); }
  }

  function restartMatch(){ scores = {You:0,AI:0,T:0}; resetBoard(true); render(); }

  // ===== Music controls & auto-intensify =====
  function startMusic(){ try{ if(!musicMuted) currentMusic.play(); }catch(e){} }
  function switchTrack(){ currentMusic.pause(); currentMusic = currentMusic === calmTrack ? intenseTrack : calmTrack; if(!musicMuted) currentMusic.play(); }
  function setIntenseIfNeeded(){ const filled = board.filter(Boolean).length; if(filled>=5 && currentMusic===calmTrack){ currentMusic.pause(); currentMusic=intenseTrack; if(!musicMuted) currentMusic.play(); } }

  // hooks
  undoBtn.addEventListener('click', ()=> undo());
  restartBtn.addEventListener('click', ()=> restartMatch());
  newRoundBtn.addEventListener('click', ()=> { resetBoard(true); });
  difficultySelect.addEventListener('change', ()=> { resetBoard(false); });
  muteBtn.addEventListener('click', ()=>{ musicMuted=!musicMuted; muteBtn.textContent = musicMuted? 'Unmute':'Mute'; if(musicMuted) currentMusic.pause(); else currentMusic.play(); });
  switchMusicBtn.addEventListener('click', ()=>{ switchTrack(); });

  // keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if(e.key==='r' || e.key==='R') restartMatch();
    if(e.key==='u' || e.key==='U') undo();
    if(/^[1-9]$/.test(e.key)){
      const idx = Number(e.key)-1; const el = boardEl.querySelector(`.cell[data-index='${idx}']`); if(el) { el.focus(); el.click(); }
    }
    // arrow navigation when a cell focused
    const cells = Array.from(boardEl.querySelectorAll('.cell'));
    if(document.activeElement && document.activeElement.classList.contains('cell')){
      const cur = Number(document.activeElement.getAttribute('data-index'));
      let next = null;
      if(e.key==='ArrowRight') next = (cur%3<2)?cur+1:cur;
      if(e.key==='ArrowLeft') next = (cur%3>0)?cur-1:cur;
      if(e.key==='ArrowDown') next = (cur+3<9)?cur+3:cur;
      if(e.key==='ArrowUp') next = (cur-3>=0)?cur-3:cur;
      if(next!==null && next!==cur){ e.preventDefault(); cells[next].focus(); }
    }
  });

  // when the board changes, re-evaluate music intensity
  const originalRender = render;
  render = function(){ originalRender(); setIntenseIfNeeded(); };

  // initial setup
  createBoard(); resetBoard(false); startMusic(); render();

  // expose for debugging
  window._proT3 = {board, history, makeMove, aiMove, resetBoard, restartMatch};

  </script>
</body>
</html>
